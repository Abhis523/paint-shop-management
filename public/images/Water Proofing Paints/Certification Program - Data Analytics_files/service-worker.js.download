var webengage=self.webengage||{};!function(e,t,n){!function(e,n){t.__loaded||(t.__loaded=!0,t.require=function(r){if(!e[r]){if(!n[r])throw new Error('Cannot find module "'+r+'"');var i=e[r]={exports:{}};n[r][0].call(i.exports,function(e){return t.require(n[r][1][e]||e)},i,i.exports)}return e[r].exports},t.modules=function(r,i,o){for(var a in r)r.hasOwnProperty(a)&&!n.hasOwnProperty(a)&&(n[a]=r[a]);for(var c=0;c<o.length;c++)e.hasOwnProperty(o[c])||t.require(o[c])})}({},{}),t.modules({"webengage/util/bare":[function(e,r,i){"use strict";var o={copy:function(e,t,r,i){r=r!==!1;for(var o in t)if(t.hasOwnProperty(o)&&(e[o]===n||r)){if(i&&t[o]==n)continue;e[o]=t[o]}return e},clone:function(e,t){return o.copy(o.copy({},e),t)},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},strunc:function(e,t){return e&&e.substr(0,t)},isArray:function(e){return e&&e.constructor==Array},inArray:function(e,t){return-1!==o.indexOfArray(e,t)},indexOfArray:function(e,t,n){return e.indexOf(t,n)},mapArray:function(e,t){return e.map(t)},stringify:function(e){return JSON.stringify(e)},parseJSON:function(e){return JSON.parse(e)},getHashCode:function(e){e=e||"";for(var t=0,n=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return n},capitalize:function(e){return"string"==typeof e&&e.length>0&&(e=e.charAt(0).toUpperCase()+e.substring(1)),e},ensureString:function(e){return"string"==typeof e?e:""},escapeScopeChars:function(e){return(e+"").replace(/([,#[\]\\])/g,"$1")},escapeForRegExp:function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},toDateISOString:function(e){return e.toISOString()},fromDateISOString:function(e){return new Date(e)},guard:function(e,n){if("function"!=typeof e)throw new Error("guard() - First argument is not a function");return function(){try{return e.apply(this,arguments)}catch(r){if(t.require("webengage/events").publish("error",r),n!==!0)throw r}}},addParamsToURL:function(e,t){var r=[];for(var i in t)t.hasOwnProperty(i)&&t[i]!=n&&r.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return r.length&&(-1===e.indexOf("?")?e+="?":e.indexOf("?")!==e.length-1&&"&"!==e.charAt(e.length-1)&&(e+="&"),e+=r.join("&")),e},base64Encode:function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},base64Decode:function(e){return decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""))},urlBase64ToUint8Array:function(e){for(var t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/\-/g,"+").replace(/_/g,"/"),r=atob(n),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r.charCodeAt(o);return i}};r.exports=o},{}],"webengage/util/compress":[function(e,t,n){"use strict";var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(null==e)return"";var t,n,i,o,a,c,s,u="",f=0;for(e=r.compress(e);f<2*e.length;)f%2==0?(t=e.charCodeAt(f/2)>>8,n=255&e.charCodeAt(f/2),i=f/2+1<e.length?e.charCodeAt(f/2+1)>>8:NaN):(t=255&e.charCodeAt((f-1)/2),(f+1)/2<e.length?(n=e.charCodeAt((f+1)/2)>>8,i=255&e.charCodeAt((f+1)/2)):n=i=NaN),f+=3,o=t>>2,a=(3&t)<<4|n>>4,c=(15&n)<<2|i>>6,s=63&i,isNaN(n)?c=s=64:isNaN(i)&&(s=64),u=u+r._keyStr.charAt(o)+r._keyStr.charAt(a)+r._keyStr.charAt(c)+r._keyStr.charAt(s);return u},decompressFromBase64:function(e){if(null==e)return"";var t,n,i,o,a,c,s,u,f="",d=0,l=0,p=r._f;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)a=r._keyStr.indexOf(e.charAt(l++)),c=r._keyStr.indexOf(e.charAt(l++)),s=r._keyStr.indexOf(e.charAt(l++)),u=r._keyStr.indexOf(e.charAt(l++)),n=a<<2|c>>4,i=(15&c)<<4|s>>2,o=(3&s)<<6|u,d%2==0?(t=n<<8,64!=s&&(f+=p(t|i)),64!=u&&(t=o<<8)):(f+=p(t|n),64!=s&&(t=i<<8),64!=u&&(f+=p(t|o))),d+=3;return r.decompress(f)},compress:function(e){if(null==e)return"";var t,n,i,o={},a={},c="",s="",u="",f=2,d=3,l=2,p="",g=0,h=0,b=r._f;for(i=0;i<e.length;i+=1)if(c=e.charAt(i),Object.prototype.hasOwnProperty.call(o,c)||(o[c]=d++,a[c]=!0),s=u+c,Object.prototype.hasOwnProperty.call(o,s))u=s;else{if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(t=0;l>t;t++)g<<=1,15==h?(h=0,p+=b(g),g=0):h++;for(n=u.charCodeAt(0),t=0;8>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1}else{for(n=1,t=0;l>t;t++)g=g<<1|n,15==h?(h=0,p+=b(g),g=0):h++,n=0;for(n=u.charCodeAt(0),t=0;16>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1}f--,0==f&&(f=Math.pow(2,l),l++),delete a[u]}else for(n=o[u],t=0;l>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1;f--,0==f&&(f=Math.pow(2,l),l++),o[s]=d++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(a,u)){if(u.charCodeAt(0)<256){for(t=0;l>t;t++)g<<=1,15==h?(h=0,p+=b(g),g=0):h++;for(n=u.charCodeAt(0),t=0;8>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1}else{for(n=1,t=0;l>t;t++)g=g<<1|n,15==h?(h=0,p+=b(g),g=0):h++,n=0;for(n=u.charCodeAt(0),t=0;16>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1}f--,0==f&&(f=Math.pow(2,l),l++),delete a[u]}else for(n=o[u],t=0;l>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1;f--,0==f&&(f=Math.pow(2,l),l++)}for(n=2,t=0;l>t;t++)g=g<<1|1&n,15==h?(h=0,p+=b(g),g=0):h++,n>>=1;for(;;){if(g<<=1,15==h){p+=b(g);break}h++}return p},decompress:function(e){if(null==e)return"";if(""==e)return null;var t,n,i,o,a,c,s,u,f=[],d=4,l=4,p=3,g="",h="",b=r._f,v={string:e,val:e.charCodeAt(0),position:32768,index:1};for(n=0;3>n;n+=1)f[n]=n;for(o=0,c=Math.pow(2,2),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;switch(t=o){case 0:for(o=0,c=Math.pow(2,8),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;u=b(o);break;case 1:for(o=0,c=Math.pow(2,16),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;u=b(o);break;case 2:return""}for(f[3]=u,i=h=u;;){if(v.index>v.string.length)return"";for(o=0,c=Math.pow(2,p),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;switch(u=o){case 0:for(o=0,c=Math.pow(2,8),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;f[l++]=b(o),u=l-1,d--;break;case 1:for(o=0,c=Math.pow(2,16),s=1;s!=c;)a=v.val&v.position,v.position>>=1,0==v.position&&(v.position=32768,v.val=v.string.charCodeAt(v.index++)),o|=(a>0?1:0)*s,s<<=1;f[l++]=b(o),u=l-1,d--;break;case 2:return h}if(0==d&&(d=Math.pow(2,p),p++),f[u])g=f[u];else{if(u!==l)return null;g=i+i.charAt(0)}h+=g,f[l++]=i+g.charAt(0),d--,i=g,0==d&&(d=Math.pow(2,p),p++)}}};t.exports=r},{}],"webengage/util/sha1":[function(e,t,n){"use strict";t.exports=function(e){function t(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function n(e,t){return e<<t|e>>>32-t}function r(e){for(var t,n="",r=7;r>=0;r--)t=e>>>4*r&15,n+=t.toString(16);return n}e=unescape(encodeURIComponent(e));var i=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var o=e.length/4+2,a=Math.ceil(o/16),c=new Array(a),s=0;a>s;s++){c[s]=new Array(16);for(var u=0;16>u;u++)c[s][u]=e.charCodeAt(64*s+4*u)<<24|e.charCodeAt(64*s+4*u+1)<<16|e.charCodeAt(64*s+4*u+2)<<8|e.charCodeAt(64*s+4*u+3)}c[a-1][14]=8*(e.length-1)/Math.pow(2,32),c[a-1][14]=Math.floor(c[a-1][14]),c[a-1][15]=8*(e.length-1)&4294967295;for(var f,d,l,p,g,h=1732584193,b=4023233417,v=2562383102,w=271733878,y=3285377520,_=new Array(80),s=0;a>s;s++){for(var m=0;16>m;m++)_[m]=c[s][m];for(var m=16;80>m;m++)_[m]=n(_[m-3]^_[m-8]^_[m-14]^_[m-16],1);f=h,d=b,l=v,p=w,g=y;for(var m=0;80>m;m++){var S=Math.floor(m/20),A=n(f,5)+t(S,d,l,p)+g+i[S]+_[m]&4294967295;g=p,p=l,l=n(d,30),d=f,f=A}h=h+f&4294967295,b=b+d&4294967295,v=v+l&4294967295,w=w+p&4294967295,y=y+g&4294967295}return r(h)+r(b)+r(v)+r(w)+r(y)}},{}],"webengage/util/transit":[function(e,t,n){"use strict";var r=e("webengage/util/type"),i=e("webengage/util/bare"),o={encode:function(e){function t(e,n){var o;if(n=n?n.slice():[],null===e)return null;if("string"===r(e))return"~"==e.charAt(0)?"~"+e:e;if("date"===r(e))return"~t"+i.toDateISOString(e);if("array"===r(e)){o=[];for(var a=0;a<e.length;a++)o[a]=t(e[a],n);return o}if("object"===r(e)){if(-1==i.indexOfArray(n,e)){n.push(e),o={};for(var c in e)e.hasOwnProperty(c)&&(o[t(c)]=t(e[c],n));return o}throw new Error("Encountered circular references while encoding data in transit format")}return e}return t(e)},decode:function(e){function t(e){var n;if(null===e)return null;if("string"===r(e))return 0===e.indexOf("~t")?i.fromDateISOString(e.substr(2)):0===e.indexOf("~~")?e.substr(1):e;if("array"===r(e)){n=[];for(var o=0;o<e.length;o++)n[o]=t(e[o]);return n}if("object"===r(e)){n={};for(var a in e)e.hasOwnProperty(a)&&(n[t(a)]=t(e[a]));return n}return e}return t(e)}};t.exports=o},{}],"webengage/util/type":[function(e,t,r){"use strict";var i=Object.prototype.toString;t.exports=function(e){var t=i.call(e);switch(t){case"[object String]":return"string";case"[object Number]":return"number";case"[object Boolean]":return"boolean";case"[object Date]":return"date";case"[object Array]":return"array";case"[object Function]":return"function";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments"}return null===e?"null":e===n?"undefined":"[object Object]"===t?"object":t.slice(8,-1)}},{}],"webengage/web-push/service-worker":[function(t,n,r){"use strict";function i(e){var t=(e||"").match(/#context=(\S*)$/);return t&&t[1]?JSON.parse(h.base64Decode(decodeURIComponent(t[1]))):null}function o(e){var t=indexedDB.open("WE_PUSH",1);t.onupgradeneeded=function(e){var t=e.target.result;t.createObjectStore("user",{keyPath:"id"})},t.onsuccess=function(t){var n=t.target.result;n.onerror=function(e){u(e.target.error,"Error in indexedDB")},"function"==typeof e&&e(n)}}function a(e){return w(e)}function c(e){var t={id:"context",license_code:e.license_code,luid:e.luid,suid:e.suid,permission:Notification.permission};return e.cuid&&(t.cuid=e.cuid),e.opt_in_url&&(t.opt_in_url=e.opt_in_url),t}function s(e,t,n){o(function(r){var i=r.transaction(["user"]).objectStore("user").get("context");i.onsuccess=function(i){var o=i.target.result;if(n=h.copy({sdk_id:1},n||{},!0),o||(o=n),n.license_code&&n.license_code!==o.license_code&&(o=n),o&&o.license_code){var a={license_code:o.license_code,luid:o.luid,suid:o.suid,category:"system",event_name:e||"unknown",event_data:h.copy({},t||{},!0),system_data:n};o.cuid&&(a.cuid=o.cuid),(o.interfaceId||n.interface_id)&&(a.interface_id=n.interface_id||o.interfaceId),delete n.license_code,delete n.interface_id,delete n.cuid,delete n.luid;var c=JSON.stringify(b.encode([a]));c=v.compressToBase64(c),fetch("https://c.webengage.com/l3.jpg",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"data="+encodeURIComponent(c)})["catch"](function(e){u(e,"Error in logging event")})}r.close()}})}function u(t,n,r,i){try{n=n||"",t instanceof Error&&(i=t.stack||t.description,i=i.length>900?i.substring(0,900):i,n=n+" - "+(t.message||i.substring(0,50)),r="exception.sw"),r&&(i="["+e.registration.scope+"] "+i,fetch(h.addParamsToURL("//c.webengage.com/e.jpg",{event:n,category:"",type:r,data:JSON.stringify({version:"6.0",text:i}),ts:(new Date).getTime()})))}catch(o){}}function f(){setInterval(function(){o(function(e){var t=e.transaction(["user"],"readwrite").objectStore("user"),n=t.get("context");n.onsuccess=function(n){var r=n.target.result;r&&r.id&&"granted"===r.permission&&r.permission!==Notification.permission&&(s(C,{source:"service-worker"}),s(x,null,{interface_id:r.interfaceId}),r.permission=Notification.permission,s(_,null,{interface_id:r.interfaceId}),delete r.interfaceId,delete r.subscription,delete r.opt_in_url,t.put(r),e.close())}}),e.registration.pushManager.getSubscription().then(function(e){o(function(t){var n=t.transaction(["user"],"readwrite").objectStore("user"),r=n.get("context");r.onsuccess=function(r){var i=r.target.result;i&&(!e||i.subscription&&e.endpoint===i.subscription.endpoint||(i.interfaceId&&s(x,null,{interface_id:i.interfaceId}),i.interfaceId=a(e.endpoint),i.subscription=e.toJSON(),n.put(i),s(y,{subscription:e.toJSON()}),s(m,{},{opt_in_push:!0,opt_in_url:i.opt_in_url})),t.close())}})})},6e5)}function d(t){e.registration.pushManager.getSubscription().then(function(n){if(n)o(function(e){var r=e.transaction(["user"],"readwrite").objectStore("user"),i=r.get("context");i.onsuccess=function(){var i=c(t);i.permission="granted",i.interfaceId=a(n.endpoint),i.subscription=n.toJSON(),r.put(i),e.close(),s(y,{subscription:n.toJSON(),type:t.wp_vapid?"vapid":"refresh"},t.system_data),s(m,{},{opt_in_push:!0,opt_in_url:t.opt_in_url}),g(t)}});else{var r={userVisibleOnly:!0};t.vapidPublicKey?(t.wp_vapid=!0,r={userVisibleOnly:!0,applicationServerKey:h.urlBase64ToUint8Array(t.vapidPublicKey)}):t.wp_vapid=!1,e.registration.pushManager.subscribe(r).then(function(){d(t)})["catch"](function(e){u(e,"Error in pushManager.subscribe()")})}})}function l(e){o(function(t){var n=t.transaction(["user"],"readwrite").objectStore("user"),r=n.get("context");r.onsuccess=function(r){var i=c(e),o=r.target.result;o&&o.subscription&&(i.interfaceId=o.interfaceId||null,i.subscription=o.subscription),n.put(i),t.close(),s(e.eventName,null,e.system_data)}})}function p(t,n){if(t=t||{},"WebEngage"!==t.source)return Promise.resolve();var r={experiment_id:t.experimentId,id:t.id,scope:t.scope,license_code:t.licenseCode,luid:t.luid,interface_id:t.interfaceId,cuid:t.cuid};if(t.journeyId&&(r.journey_id=t.journeyId),s(S,{},h.copy({},r)),t.secondaryCta){t.actions=t.secondaryCta,r.actions={};for(var i=0;i<t.actions.length;i++)r.actions[t.actions[i].action]={url:t.actions[i].url}}return t.cta&&t.cta.actionLink&&(r.url=t.cta.actionLink,r.cta=t.cta.id),t.body=t.description,t.icon=(t.icon||"")+"#context="+encodeURIComponent(h.base64Encode(JSON.stringify(r))),t.badge=(t.badge||"")+"#context="+encodeURIComponent(h.base64Encode(JSON.stringify(r))),e.registration.showNotification(t.title,t)}function g(t){function n(n){return n=n||{title:"Thanks for subscribing",body:"You are awesome",icon:t.icon},n.cta&&n.cta.actionLink&&n.icon&&(n.icon=n.icon+"#context="+encodeURIComponent(h.base64Encode(JSON.stringify({url:n.cta.actionLink})))),e.registration.showNotification(n.title,n)}t.hideSubscriptionMessage||fetch(h.addParamsToURL("https://p.webengage.com:443/users/"+t.license_code+"/"+t.luid+"/templates/WEBPUSH_ACK_"+t.license_code,t.cuid?{cuid:t.cuid}:{}),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.p13n||{}),mode:"cors"}).then(function(e){if(200!==e.status){if(404===e.status)return n();throw new Error}return e.json().then(function(e){if(!(e&&e.templateData&&e.status&&e.status.success))throw new Error;return n(e.templateData)})})["catch"](function(e){u(e,"Error in fetching subscription message")})}var h=t("webengage/util/bare"),b=t("webengage/util/transit"),v=t("webengage/util/compress"),w=t("webengage/util/sha1"),y="push_notification_registered",_="push_notification_unregistered",m="user_update",S="push_notification_view",A="push_notification_click",O="push_notification_close",C="push_notification_opt_out",x="user_delete_device";e.addEventListener("install",function(t){t.waitUntil(e.skipWaiting().then(function(){o()}))}),e.addEventListener("activate",function(t){t.waitUntil(e.clients.claim().then(function(){f()}))}),e.addEventListener("message",function(e){try{var t=JSON.parse(e.data);t.eventName===y?d(t):l(t)}catch(n){u(n,"Error in parsing message data")}}),e.addEventListener("push",function(t){t.data?t.waitUntil(p(t.data.json(),t)):t.waitUntil(e.registration.pushManager.getSubscription().then(function(e){return fetch("https://z.webengagepush.com/payload/"+a(e.endpoint)).then(function(e){if(200!==e.status)throw new Error;return e.json().then(function(e){if("success"!==e.status)throw new Error;return p(e.data,t)})})["catch"](function(e){u(e,"Error in fetching payload")})}))}),e.addEventListener("notificationclose",function(e){var t=i(e.notification.icon);t&&!e.notification.onclick&&(delete t.actions,delete t.url,delete t.cta,s(O,{},t))}),e.addEventListener("notificationclick",function(e){e.notification.onclick=function(){},e.notification.close();var t=i(e.notification.icon);if(t){var n=t.url;e.action&&t.actions&&t.actions[e.action]&&(t.cta=e.action,n=t.actions[e.action].url),delete t.actions,delete t.url,n||delete t.cta,t.experiment_id&&s(A,{},t),n&&e.waitUntil(clients.matchAll({type:"window"}).then(function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.url===n&&"focus"in r)return r.focus()}return clients.openWindow?clients.openWindow(n):void 0}))}})},{}]},{},["webengage/web-push/service-worker"])}(self,webengage);